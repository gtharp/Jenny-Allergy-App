<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Jenny Allergy App</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>Pollen Report for San Antonio, TX</h1>
    <div class="pollen-report">
      <div class="pollen-item">
        <h2>Tree Pollen</h2>
        <p id="treePollen">Loading...</p>
      </div>
      <div class="pollen-item">
        <h2>Ragweed Pollen</h2>
        <p id="ragweedPollen">Loading...</p>
      </div>
    </div>
    <p class="timestamp">Last Updated: <span id="lastUpdated">--:--</span></p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Replace YOUR_TOMORROW_IO_API_KEY with your actual key
      const API_KEY = 4EyBhiKMv0nkC5g7P0Q9hgHLRhFKHeGL;
      const lat = 29.4241;
      const lon = -98.4936;
      const mapping = ['None', 'Low', 'Medium', 'High', 'Extreme'];

      async function fetchPollen() {
        try {
          const response = await fetch(
            `https://api.tomorrow.io/v4/timelines?location=${lat},${lon}&fields=pollen_tree_index,pollen_ragweed_index&timesteps=1d&units=metric&apikey=${API_KEY}`
          );
          const data = await response.json();
          const today = data.data.timelines[0].intervals[0].values;
          const treeIndex = today.pollen_tree_index;
          const ragweedIndex = today.pollen_ragweed_index;

          const treeLabel = mapping[Math.min(treeIndex, mapping.length - 1)];
          const ragweedLabel = mapping[Math.min(ragweedIndex, mapping.length - 1)];

          const treeEl = document.getElementById('treePollen');
          const ragweedEl = document.getElementById('ragweedPollen');
          treeEl.textContent = treeLabel;
          ragweedEl.textContent = ragweedLabel;

          // Add classes for styling
          treeEl.className = treeLabel;
          ragweedEl.className = ragweedLabel;

          const now = new Date();
          document.getElementById('lastUpdated').textContent = now.toLocaleString();
        } catch (err) {
          console.error(err);
          document.getElementById('treePollen').textContent = 'Error';
          document.getElementById('ragweedPollen').textContent = 'Error';
        }
      }

      fetchPollen();
    });
  </script>
</body>
</html>
